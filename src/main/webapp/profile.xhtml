<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:pt="http://xmlns.jcp.org/jsf/passthrough">

    <head>
        <title>Profile | Online CV</title>
        <meta charset="UTF-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <link rel="stylesheet" href="css/style.css"/>
        <script src="js/profile.js" />
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous"/>
    </head>
    <body>
        <f:metadata>
            <f:viewParam name="id" value="#{profileBean.userId}" />
            <f:viewAction action="#{profileBean.onload}" />
        </f:metadata>

        <ui:include src="/WEB-INF/include/header.xhtml"/>

        <div id="user-infos">
            #{profileBean.user.firstName} 
            #{profileBean.user.lastName} 
            #{profileBean.user.email}
        </div>

        <div id='description'>
            <c:choose>
                <c:when test="#{not empty profileBean.user.description}">
                    #{profileBean.user.description}
                </c:when>
                <c:otherwise>
                    <c:if test="#{profileBean.isOwnProfile()}">
                        No description set
                    </c:if>
                </c:otherwise>
            </c:choose>
            <c:if test="#{profileBean.isOwnProfile()}">
                <button onclick="editDescription();" >Edit</button>
            </c:if>
        </div>

        <div id="personal-infos">
            <div id="address">
                <c:choose>
                    <c:when test="#{not empty profileBean.user.address}">
                        #{profileBean.user.address}
                    </c:when>
                    <c:otherwise>
                        <c:if test="#{profileBean.isOwnProfile()}">
                            No address set
                        </c:if>
                    </c:otherwise>
                </c:choose>
            </div>

            <div id="telephone">
                <c:choose>
                    <c:when test="#{not empty profileBean.user.telephoneNumber}">
                        #{profileBean.user.telephoneNumber}
                    </c:when>
                    <c:otherwise>
                        <c:if test="#{profileBean.isOwnProfile()}">
                            No telephone number set
                        </c:if>
                    </c:otherwise>
                </c:choose>
            </div>

            <div id="gender">
                <c:choose>
                    <c:when test="#{not empty profileBean.user.gender}">
                        #{profileBean.user.gender}
                    </c:when>
                    <c:otherwise>
                        <c:if test="#{profileBean.isOwnProfile()}">
                            No gender set
                        </c:if>
                    </c:otherwise>
                </c:choose>
            </div>
        </div>


        <c:if test="#{profileBean.canSeeSection('Experience')}">
            <h2>Work Experience</h2>
            <c:if test="#{profileBean.isOwnProfile()}">
                <button value="+" name="+" onclick="switchVisibility(addWork)">+</button>
            </c:if>

            <c:if test="#{profileBean.isOwnProfile()}">
                <div id="add-work" hidden="true">
                    <h:form>
                        <p>
                            <h:inputText value="#{experienceManagedBean.title}" pt:placeholder="Title" required="true" requiredMessage="Enter a title" />
                            <h:inputText value="#{experienceManagedBean.company}" pt:placeholder="Company" required="true" requiredMessage="Enter a valid company name" />
                            <h:inputText value="#{experienceManagedBean.location}" pt:placeholder="Location" />
                            <h:selectOneMenu value="#{experienceManagedBean.startMonth}" >
                                <f:selectItem itemLabel="Month" />
                                <f:selectItem itemValue="1" itemLabel="January" />
                                <f:selectItem itemValue="2" itemLabel="February" />
                                <f:selectItem itemValue="3" itemLabel="March" />
                                <f:selectItem itemValue="4" itemLabel="April" />
                                <f:selectItem itemValue="5" itemLabel="May" />
                                <f:selectItem itemValue="6" itemLabel="June" />
                                <f:selectItem itemValue="7" itemLabel="July" />
                                <f:selectItem itemValue="8" itemLabel="August" />
                                <f:selectItem itemValue="9" itemLabel="September" />
                                <f:selectItem itemValue="10" itemLabel="October" />
                                <f:selectItem itemValue="11" itemLabel="November" />
                                <f:selectItem itemValue="12" itemLabel="December" />
                            </h:selectOneMenu>
                            <h:inputText value="#{experienceManagedBean.startYear}" pt:placeholder="Year" />
                            - 
                            <h:selectOneMenu value="#{experienceManagedBean.endMonth}" >
                                <f:selectItem itemLabel="Month" />
                                <f:selectItem itemValue="1" itemLabel="January" />
                                <f:selectItem itemValue="2" itemLabel="February" />
                                <f:selectItem itemValue="3" itemLabel="March" />
                                <f:selectItem itemValue="4" itemLabel="April" />
                                <f:selectItem itemValue="5" itemLabel="May" />
                                <f:selectItem itemValue="6" itemLabel="June" />
                                <f:selectItem itemValue="7" itemLabel="July" />
                                <f:selectItem itemValue="8" itemLabel="August" />
                                <f:selectItem itemValue="9" itemLabel="September" />
                                <f:selectItem itemValue="10" itemLabel="October" />
                                <f:selectItem itemValue="11" itemLabel="November" />
                                <f:selectItem itemValue="12" itemLabel="December" />
                            </h:selectOneMenu>
                            <h:inputText value="#{experienceManagedBean.endYear}" pt:placeholder="Year" />
                            <h:inputTextarea value="#{experienceManagedBean.description}" pt:placeholder="Description" />
                        </p>
                        <p>
                            <h:commandButton action="#{experienceManagedBean.addExperience()}" value="Add it !" />
                        </p>
                    </h:form>
                </div>
            </c:if>

            <ui:repeat var="experience" value="#{profileBean.user.experienceList}">
                <div class="education" style="margin: 5px; padding: 5px; border: 1px solid black;">
                    #{experience.title} 
                    #{experience.companyName}
                    <c:if test="#{profileBean.isOwnProfile()}" >
                        <h:form>
                            <h:commandButton action="#{experienceManagedBean.removeExperience(experience)}" value="x" />
                        </h:form>
                    </c:if>
                </div>
            </ui:repeat>
        </c:if>

        <c:if test="#{profileBean.canSeeSection('Education')}">
            <h2>Education</h2>
            <c:if test="#{profileBean.isOwnProfile()}">
                <button value="+" name="+" onclick="switchVisibility(addEducation)">+</button>
            </c:if>

            <c:if test="#{profileBean.isOwnProfile()}">
                <div id="add-education" hidden="true">
                    <h:form>
                        <p>
                            <h:inputText value="#{educationManagedBean.title}" pt:placeholder="Title" required="true" requiredMessage="Enter a title" />
                            <h:inputText value="#{educationManagedBean.school}" pt:placeholder="School" required="true" requiredMessage="Enter a valid school name" />
                            <h:inputText value="#{educationManagedBean.location}" pt:placeholder="Location" />
                            <h:selectOneMenu value="#{educationManagedBean.startMonth}">
                                <f:selectItem itemLabel="Month" />
                                <f:selectItem itemValue="1" itemLabel="January" />
                                <f:selectItem itemValue="2" itemLabel="February" />
                                <f:selectItem itemValue="3" itemLabel="March" />
                                <f:selectItem itemValue="4" itemLabel="April" />
                                <f:selectItem itemValue="5" itemLabel="May" />
                                <f:selectItem itemValue="6" itemLabel="June" />
                                <f:selectItem itemValue="7" itemLabel="July" />
                                <f:selectItem itemValue="8" itemLabel="August" />
                                <f:selectItem itemValue="9" itemLabel="September" />
                                <f:selectItem itemValue="10" itemLabel="October" />
                                <f:selectItem itemValue="11" itemLabel="November" />
                                <f:selectItem itemValue="12" itemLabel="December" />
                            </h:selectOneMenu>
                            <h:inputText value="#{educationManagedBean.startYear}" pt:placeholder="Year" />
                            - 
                            <h:selectOneMenu value="#{educationManagedBean.endMonth}" >
                                <f:selectItem itemLabel="Month" />
                                <f:selectItem itemValue="1" itemLabel="January" />
                                <f:selectItem itemValue="2" itemLabel="February" />
                                <f:selectItem itemValue="3" itemLabel="March" />
                                <f:selectItem itemValue="4" itemLabel="April" />
                                <f:selectItem itemValue="5" itemLabel="May" />
                                <f:selectItem itemValue="6" itemLabel="June" />
                                <f:selectItem itemValue="7" itemLabel="July" />
                                <f:selectItem itemValue="8" itemLabel="August" />
                                <f:selectItem itemValue="9" itemLabel="September" />
                                <f:selectItem itemValue="10" itemLabel="October" />
                                <f:selectItem itemValue="11" itemLabel="November" />
                                <f:selectItem itemValue="12" itemLabel="December" />
                            </h:selectOneMenu>
                            <h:inputText value="#{educationManagedBean.endYear}" pt:placeholder="Year" />
                            <h:inputTextarea value="#{educationManagedBean.description}" pt:placeholder="Description" />
                        </p>
                        <p>
                            <h:commandButton action="#{educationManagedBean.addEducation()}" value="Add it !" />
                        </p>
                    </h:form>
                </div>
            </c:if>


            <ui:repeat var="education" value="#{profileBean.user.educationList}">
                <div class="education" style="margin: 5px; padding: 5px; border: 1px solid black;">
                    #{education.title} 
                    #{education.schoolName}
                    <c:if test="#{profileBean.isOwnProfile()}" >
                        <h:form>
                            <h:commandButton action="#{educationManagedBean.removeEducation(education)}" value="x" />
                        </h:form>
                    </c:if>
                </div>
            </ui:repeat>
        </c:if>

        <c:if test="#{profileBean.canSeeSection('Skills')}">
            <h2>Skills</h2>
            <c:if test="#{profileBean.isOwnProfile()}">
                <button value="+" name="+" onclick="switchVisibility(addSkills)">+</button>
            </c:if>

            <c:if test="#{profileBean.isOwnProfile()}">
                <div id="add-skills" hidden="true">
                    <h:form>
                        <h:inputText value="#{skillManagedBean.label}" pt:placeholder="Skill" required="true" requiredMessage="Enter a skill" />
                        <p>
                            <h:commandButton action="#{skillManagedBean.addSkill()}" value="Add it !" />
                        </p>
                    </h:form>
                </div>     
            </c:if>

            <ui:repeat var="skill" value="#{profileBean.user.skillList}">
                <div class="skill" style="margin: 5px; padding: 5px; border: 1px solid black;">
                    #{skill.label}
                    <c:if test="#{profileBean.isOwnProfile()}" >
                        <h:form>
                            <h:commandButton action="#{skillManagedBean.removeSkill(skill)}" value="x" />
                        </h:form>
                    </c:if>
                </div>
            </ui:repeat>
        </c:if>

        <c:if test="#{profileBean.canSeeSection('Languages')}">
            <h2>Languages</h2>
            <c:if test="#{profileBean.isOwnProfile()}">
                <button value="+" name="+" onclick="switchVisibility(addLanguages)">+</button>
            </c:if>

            <c:if test="#{profileBean.isOwnProfile()}">
                <div id="add-languages" hidden="true">
                    <h:form>
                        <h:inputText value="#{languageManagedBean.label}" pt:placeholder="Language" required="true" requiredMessage="Enter a language" />
                        <h:selectOneMenu value="#{languageManagedBean.proficiency}" required="true" requiredMessage="Select your proficiency" >
                            <f:selectItem itemValue="1" itemLabel="Beginner" />
                            <f:selectItem itemValue="2" itemLabel="Conversational" />
                            <f:selectItem itemValue="3" itemLabel="Business" />
                            <f:selectItem itemValue="4" itemLabel="Fluent" />
                            <f:selectItem itemValue="5" itemLabel="Native" />
                        </h:selectOneMenu>
                        <p>
                            <h:commandButton action="#{languageManagedBean.addLanguage()}" value="Add it !" />
                        </p>
                    </h:form>
                </div>
            </c:if>

            <ui:repeat var="speaks" value="#{profileBean.user.speaksList}">
                <div class="skill" style="margin: 5px; padding: 5px; border: 1px solid black;">
                    #{speaks.language.label}
                    <script>
                        document.write(proficiencyIdToString(#{speaks.proficiency}));
                    </script>
                    <c:if test="#{profileBean.isOwnProfile()}" >
                        <h:form>
                            <h:commandButton action="#{languageManagedBean.removeLanguage(speaks)}" value="x" />
                        </h:form>
                    </c:if>
                </div>
            </ui:repeat>
        </c:if>
    </body>
</html>